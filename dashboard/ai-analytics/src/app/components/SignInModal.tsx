import { useTrackEvent } from "@/hooks/useTrackEvent";
import { useSignIn } from "@clerk/nextjs";
import { X } from "lucide-react";

interface SignInModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function SignInModal({ isOpen, onClose }: SignInModalProps) {
  const track = useTrackEvent();
  const { signIn } = useSignIn();

  if (!isOpen) return null;
  if (!signIn) return null;

  const handleGoogleSignIn = async () => {
    track("click_sign_in", {
      provider: "google",
    });

    try {
      await signIn.authenticateWithRedirect({
        strategy: "oauth_google",
        redirectUrl: "/sso-callback",
        redirectUrlComplete: "/",
      });
    } catch (err) {
      console.error("OAuth error:", err);
    }
  };

  const handleGithubSignIn = async () => {
    track("click_sign_in", {
      provider: "github",
    });

    try {
      await signIn.authenticateWithRedirect({
        strategy: "oauth_github",
        redirectUrl: "/sso-callback",
        redirectUrlComplete: "/",
      });
    } catch (err) {
      console.error("OAuth error:", err);
    }
  };

  return (
    <>
      <div 
        className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50"
        onClick={onClose}
      />
      
      <div className="fixed inset-0 flex items-center justify-center z-50 p-4">
        <div 
          style={{ width: '575px', minWidth: '575px' }} 
          className="bg-[#262626] w-full max-w-md flex flex-col relative"
          onClick={(e) => e.stopPropagation()}
        >
          {/* Header */}
          <div className="flex items-center justify-between p-4">
            <h2 className="title-font">Sign In to Tinybird AI Analytics</h2>
            <button 
              onClick={onClose}
              className="settings-button p-2"
            >
              <X className="h-4 w-4 text-white" />
            </button>
          </div>

          {/* Content */}
          <div className="p-4 space-y-8">
            {/* Sign In Buttons Row */}
            <div className="grid grid-cols-2 gap-2">
              {/* Google Sign In */}
              <button
                onClick={handleGoogleSignIn}
                className="group flex h-[48px] items-center justify-center gap-2 py-[14px] px-4 hover:text-[var(--accent)] hover:border-[var(--accent)] transition-colors text-white border border-white default-font"
              >
                <svg className="fill-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M13.5325 8.13815C13.5325 7.73028 13.5007 7.32021 13.433 6.91895H8V9.22941H11.1112C10.9821 9.97461 10.5673 10.6338 9.95987 11.0527V12.5519H11.816C12.906 11.5069 13.5325 9.96361 13.5325 8.13815Z" fill="currentColor"/>
                  <path d="M7.99979 14.0007C9.55333 14.0007 10.8634 13.4693 11.818 12.5522L9.96177 11.053C9.44536 11.419 8.77867 11.6262 8.00197 11.6262C6.49925 11.6262 5.22511 10.5702 4.76795 9.15039H2.85254V10.6959C3.83035 12.7219 5.82196 14.0007 7.99979 14.0007Z" fill="currentColor"/>
                  <path d="M4.76625 9.15032C4.52498 8.40519 4.52498 7.59826 4.76625 6.85306V5.30762H2.85296C2.03599 7.00299 2.03599 9.00046 2.85296 10.6958L4.76625 9.15032Z" fill="currentColor"/>
                  <path d="M7.99979 4.37483C8.82104 4.3616 9.6147 4.68348 10.2095 5.27433L11.8539 3.5613C10.8126 2.54275 9.43057 1.98276 7.99979 2.0004C5.82196 2.0004 3.83035 3.27911 2.85254 5.3074L4.76584 6.85286C5.22088 5.43086 6.49713 4.37483 7.99979 4.37483Z" fill="currentColor"/>
                </svg>
                Continue with Google
              </button>

              {/* GitHub Sign In */}
              <button
                onClick={handleGithubSignIn}
                className="group flex h-[48px] items-center justify-center gap-2 py-[14px] px-4 hover:text-[var(--accent)] hover:border-[var(--accent)] transition-colors text-white border border-white default-font"
              >
                <svg className="fill-current group-hover:fill-[var(--accent)]" width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clipPath="url(#clip0_5029_69354)">
                    <path fillRule="evenodd" clipRule="evenodd" d="M8.25 0C3.8316 0 0.25 3.488 0.25 7.792C0.25 11.2352 2.542 14.156 5.7212 15.1864C6.1212 15.2584 6.2668 15.0176 6.2668 14.8104C6.2668 14.6264 6.2604 14.136 6.2564 13.4856C4.0308 13.956 3.5612 12.4408 3.5612 12.4408C3.198 11.5408 2.6732 11.3008 2.6732 11.3008C1.9468 10.8176 2.7284 10.8272 2.7284 10.8272C3.5308 10.8824 3.9532 11.6304 3.9532 11.6304C4.6668 12.8208 5.826 12.4776 6.2812 12.2784C6.3548 11.7744 6.5612 11.4304 6.79 11.236C5.014 11.04 3.146 10.3712 3.146 7.3848C3.146 6.5344 3.458 5.8384 3.9692 5.2944C3.8868 5.0968 3.6124 4.304 4.0476 3.232C4.0476 3.232 4.7196 3.0224 6.2476 4.0304C6.90099 3.85713 7.57402 3.76893 8.25 3.768C8.93 3.7712 9.614 3.8576 10.2532 4.0304C11.7804 3.0224 12.4508 3.232 12.4508 3.232C12.8876 4.304 12.6132 5.0968 12.5308 5.2944C13.0428 5.8384 13.3532 6.5344 13.3532 7.3848C13.3532 10.3784 11.482 11.0376 9.7004 11.2304C9.9876 11.4704 10.2428 11.9464 10.2428 12.6736C10.2428 13.7144 10.2332 14.5552 10.2332 14.8104C10.2332 15.0192 10.3772 15.2616 10.7836 15.1864C13.9596 14.152 16.25 11.2336 16.25 7.792C16.25 3.488 12.6676 0 8.25 0Z" fill="currentColor"/>
                  </g>
                  <defs>
                    <clipPath id="clip0_5029_69354">
                      <rect width="16" height="16" fill="white" transform="translate(0.25)"/>
                    </clipPath>
                  </defs>
                </svg>
                Continue with GitHub
              </button>
            </div>

            {/* Sign Up Link */}
            {/* <div className="text-left">
              <span className="text-[#C6C6C6] text-sm">Already have an account? </span>
              <a href="#" className="text-[#27F795] text-sm hover:underline">Sign Up</a>
            </div> */}

            {/* Secure by Clerk */}
            <div className="flex items-center gap-2">
              <span className="text-[#C6C6C6] text-sm">Secured by</span>
              <svg width="50" height="14" viewBox="0 0 50 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clipPath="url(#clip0_5029_69368)">
                  <path d="M7.88915 9.18752C9.09699 9.18752 10.0761 8.20792 10.0761 6.99952C10.0761 5.79112 9.09699 4.81152 7.88915 4.81152C6.6813 4.81152 5.70215 5.79112 5.70215 6.99952C5.70215 8.20792 6.6813 9.18752 7.88915 9.18752Z" fill="white"/>
                  <path d="M11.8297 12.1796C11.874 12.2221 11.9083 12.2739 11.9302 12.3313C11.9521 12.3887 11.9609 12.4502 11.9562 12.5114C11.9514 12.5726 11.9331 12.632 11.9025 12.6853C11.872 12.7386 11.8301 12.7845 11.7797 12.8196C10.6286 13.5912 9.2735 14.0021 7.88768 13.9996C6.5022 14.0019 5.1475 13.5911 3.99668 12.8196C3.94623 12.7846 3.90418 12.7388 3.87357 12.6855C3.84296 12.6323 3.82455 12.5729 3.81967 12.5117C3.81479 12.4504 3.82356 12.3889 3.84535 12.3315C3.86715 12.274 3.90141 12.2222 3.94568 12.1796L5.54368 10.5796C5.61587 10.5109 5.70792 10.4667 5.80669 10.4534C5.90545 10.4402 6.0059 10.4584 6.09368 10.5056C6.64887 10.7899 7.26391 10.9377 7.88768 10.9366C8.5107 10.9377 9.125 10.7903 9.67968 10.5066C9.76757 10.4592 9.86822 10.4408 9.9672 10.4541C10.0662 10.4674 10.1584 10.5117 10.2307 10.5806L11.8297 12.1786V12.1796Z" fill="white"/>
                  <path opacity="0.5" d="M11.7799 1.17999C11.8303 1.2151 11.8722 1.26096 11.9027 1.31425C11.9333 1.36754 11.9516 1.42694 11.9564 1.48816C11.9611 1.54938 11.9523 1.61091 11.9304 1.66829C11.9085 1.72567 11.8742 1.77749 11.8299 1.81999L10.2319 3.41999C10.1596 3.48854 10.0675 3.5325 9.9687 3.5456C9.86994 3.55871 9.76956 3.5403 9.68187 3.49299C8.94047 3.11264 8.0975 2.97733 7.2743 3.10654C6.45111 3.23576 5.69014 3.62283 5.10092 4.21204C4.5117 4.80126 4.12463 5.56223 3.99542 6.38543C3.86621 7.20862 4.00152 8.05159 4.38187 8.79299C4.42905 8.88078 4.4473 8.98122 4.43401 9.07999C4.42072 9.17876 4.37658 9.2708 4.30787 9.34299L2.70987 10.942C2.66729 10.9864 2.61536 11.0209 2.55783 11.0428C2.50031 11.0647 2.43863 11.0735 2.37727 11.0686C2.31591 11.0637 2.2564 11.0453 2.20307 11.0145C2.14973 10.9838 2.10389 10.9416 2.06887 10.891C1.16838 9.5444 0.762805 7.92718 0.921285 6.31501C1.07977 4.70284 1.79249 3.19555 2.93796 2.05008C4.08343 0.904613 5.59072 0.191887 7.20289 0.0334067C8.81505 -0.125074 10.4323 0.280503 11.7789 1.18099L11.7799 1.17999Z" fill="white"/>
                  <path fillRule="evenodd" clipRule="evenodd" d="M23.7476 1.42152C23.7476 1.36152 23.7976 1.31152 23.8576 1.31152H25.4976C25.5576 1.31152 25.6076 1.36152 25.6076 1.42152V12.5775C25.6076 12.6067 25.5961 12.6347 25.5754 12.6553C25.5548 12.6759 25.5268 12.6875 25.4976 12.6875H23.8576C23.8285 12.6875 23.8005 12.6759 23.7799 12.6553C23.7592 12.6347 23.7476 12.6067 23.7476 12.5775V1.42152ZM21.4326 10.3215C21.4116 10.3035 21.3846 10.294 21.3569 10.2947C21.3292 10.2954 21.3027 10.3064 21.2826 10.3255C21.0254 10.5678 20.7257 10.7607 20.3986 10.8945C20.0386 11.0425 19.6516 11.1165 19.2616 11.1135C18.9316 11.1235 18.6036 11.0665 18.2966 10.9475C17.9915 10.8289 17.7136 10.6496 17.4796 10.4205C17.0556 9.98852 16.8116 9.37052 16.8116 8.63552C16.8116 7.16252 17.7916 6.15552 19.2616 6.15552C19.6556 6.15052 20.0466 6.22952 20.4056 6.38952C20.7306 6.53352 21.0226 6.73952 21.2656 6.99652C21.3056 7.04052 21.3756 7.04552 21.4206 7.00652L22.5286 6.04752C22.5394 6.03825 22.5481 6.02695 22.5545 6.01426C22.5608 6.00157 22.5645 5.98775 22.5654 5.97361C22.5664 5.95947 22.5645 5.94529 22.5599 5.93188C22.5553 5.91848 22.5481 5.90612 22.5386 5.89552C21.7066 4.96552 20.4006 4.48352 19.1596 4.48352C16.6606 4.48352 14.8896 6.16952 14.8896 8.64952C14.8896 9.87652 15.3296 10.9095 16.0716 11.6395C16.8146 12.3675 17.8726 12.7965 19.0936 12.7965C20.6236 12.7965 21.8566 12.2095 22.5786 11.4565C22.5886 11.4459 22.5963 11.4334 22.6012 11.4198C22.6062 11.4061 22.6083 11.3916 22.6075 11.3771C22.6066 11.3626 22.6028 11.3484 22.5963 11.3354C22.5898 11.3224 22.5807 11.3109 22.5696 11.3015L21.4326 10.3215ZM34.6446 9.18152C34.6417 9.20787 34.6292 9.23221 34.6094 9.24991C34.5897 9.26761 34.5642 9.27744 34.5376 9.27752H28.7896C28.7734 9.27733 28.7573 9.28088 28.7427 9.28788C28.728 9.29488 28.7152 9.30516 28.7051 9.31792C28.6951 9.33067 28.6881 9.34557 28.6847 9.36145C28.6813 9.37733 28.6817 9.39378 28.6856 9.40952C28.9716 10.4695 29.8236 11.1105 30.9876 11.1105C31.3793 11.1188 31.7677 11.0381 32.1236 10.8745C32.4536 10.7233 32.7475 10.5034 32.9856 10.2295C32.9992 10.2135 33.0186 10.2034 33.0396 10.2015C33.0606 10.1997 33.0814 10.2061 33.0976 10.2195L34.2526 11.2255C34.2966 11.2645 34.3026 11.3305 34.2656 11.3755C33.5676 12.1985 32.4376 12.7955 30.8856 12.7955C28.4996 12.7955 26.7006 11.1445 26.7006 8.63352C26.7006 7.40152 27.1246 6.36952 27.8306 5.63952C28.2036 5.26452 28.6506 4.96952 29.1446 4.76952C29.6392 4.57092 30.1688 4.47399 30.7016 4.48452C33.1206 4.48452 34.6847 6.18552 34.6847 8.53452C34.6817 8.75071 34.6684 8.96662 34.6446 9.18152ZM28.7206 7.65752C28.7161 7.67327 28.7153 7.68989 28.7183 7.706C28.7214 7.72212 28.7282 7.73728 28.7383 7.75025C28.7483 7.76322 28.7613 7.77363 28.7761 7.78063C28.791 7.78763 28.8073 7.79102 28.8236 7.79052H32.6446C32.7146 7.79052 32.7677 7.72452 32.7477 7.65652C32.4876 6.75552 31.8266 6.15352 30.8006 6.15352C30.4993 6.14397 30.1994 6.19851 29.9206 6.31352C29.6429 6.42813 29.3929 6.60102 29.1876 6.82052C28.9735 7.0626 28.8142 7.34812 28.7206 7.65752ZM40.3717 4.48552C40.4327 4.48452 40.4816 4.53352 40.4816 4.59452V6.43152C40.4815 6.44649 40.4784 6.46128 40.4724 6.47499C40.4663 6.48869 40.4576 6.50103 40.4466 6.51123C40.4357 6.52144 40.4228 6.5293 40.4087 6.53433C40.3946 6.53937 40.3796 6.54148 40.3647 6.54052C40.2133 6.52771 40.0615 6.5197 39.9096 6.51652C38.4796 6.51652 37.6396 7.52352 37.6396 8.84552V12.5775C37.6396 12.6067 37.6281 12.6347 37.6074 12.6553C37.5868 12.6759 37.5588 12.6875 37.5296 12.6875H35.8896C35.8605 12.6875 35.8325 12.6759 35.8119 12.6553C35.7912 12.6347 35.7796 12.6067 35.7796 12.5775V4.70752C35.7796 4.64752 35.8286 4.59852 35.8896 4.59852H37.5296C37.5896 4.59852 37.6396 4.64852 37.6396 4.70852V5.81252C37.6395 5.81492 37.6401 5.8173 37.6415 5.8193C37.6428 5.82131 37.6447 5.82282 37.647 5.82361C37.6493 5.82441 37.6517 5.82444 37.654 5.8237C37.6563 5.82296 37.6583 5.82149 37.6596 5.81952C38.2996 4.96252 39.2467 4.48652 40.2467 4.48652L40.3717 4.48552ZM44.8157 9.29552C44.8194 9.29149 44.824 9.28838 44.8291 9.28644C44.8342 9.28451 44.8397 9.2838 44.8452 9.28439C44.8506 9.28497 44.8558 9.28683 44.8604 9.2898C44.865 9.29278 44.8689 9.29679 44.8717 9.30152L46.9466 12.6355C46.9565 12.6514 46.9702 12.6644 46.9864 12.6735C47.0027 12.6826 47.021 12.6874 47.0396 12.6875H48.9046C48.9242 12.6874 48.9434 12.6821 48.9602 12.6722C48.9771 12.6622 48.9909 12.6479 49.0004 12.6308C49.0099 12.6137 49.0146 12.5943 49.0141 12.5748C49.0137 12.5552 49.008 12.5361 48.9977 12.5195L46.1516 7.92952C46.1393 7.90931 46.1337 7.88564 46.1359 7.86203C46.1381 7.83843 46.1478 7.81615 46.1637 7.79852L48.9056 4.77252C48.9196 4.75675 48.9288 4.73728 48.9321 4.71645C48.9353 4.69561 48.9325 4.67428 48.924 4.65499C48.9154 4.63571 48.9015 4.61929 48.8839 4.60768C48.8663 4.59607 48.8457 4.58977 48.8246 4.58952H46.8787C46.8636 4.58972 46.8487 4.59301 46.8349 4.5992C46.8211 4.6054 46.8088 4.61436 46.7986 4.62552L43.6256 8.08352C43.6106 8.09945 43.5912 8.11053 43.5698 8.11535C43.5484 8.12016 43.5261 8.11848 43.5057 8.11054C43.4853 8.10259 43.4677 8.08873 43.4553 8.07073C43.4428 8.05274 43.4359 8.03142 43.4356 8.00952V1.42152C43.4356 1.39235 43.4241 1.36437 43.4034 1.34374C43.3828 1.32311 43.3548 1.31152 43.3256 1.31152H41.6856C41.6565 1.31152 41.6285 1.32311 41.6079 1.34374C41.5872 1.36437 41.5756 1.39235 41.5756 1.42152V12.5775C41.5756 12.6375 41.6257 12.6875 41.6856 12.6875H43.3256C43.3548 12.6875 43.3828 12.6759 43.4034 12.6553C43.4241 12.6347 43.4356 12.6067 43.4356 12.5775V10.8225C43.4358 10.7946 43.4465 10.7678 43.4656 10.7475L44.8157 9.29552Z" fill="white"/>
                </g>
                <defs>
                  <clipPath id="clip0_5029_69368">
                    <rect width="50" height="14" fill="white"/>
                  </clipPath>
                </defs>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </>
  );
} 